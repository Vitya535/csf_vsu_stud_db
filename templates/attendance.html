<!DOCTYPE html>
<html lang="en">
<head>
    {% from "_macros_bootstrap" import bootstrap_form_input, bootstrap_form_button with context %}
    <meta charset="UTF-8">
    <title>Посещаемость</title>
    {% include '_header.html' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='attendance.css') }}"/>
</head>
<body>
{% include '_menu.html' %}
<div class="container-fluid text-center">
    <div class="row border-bottom border-top">
        <div class="col my-auto">
            {% if current_user.role_name in ('Teacher') %}
                <div class="form-check float-left" id="checkbox_is_groupleader_mark_attendance_form">
                    {% if can_expose_group_leader %}
                        <input type="checkbox" class="form-check-input" id="checkbox_is_groupleader_mark_attendance"
                               checked>
                    {% else %}
                        <input type="checkbox" class="form-check-input" id="checkbox_is_groupleader_mark_attendance">
                    {% endif %}
                    <label class="form-check-label" for="checkbox_is_groupleader_mark_attendance">Староста отмечает
                        посещаемость</label>
                </div>
            {% endif %}
            {% if current_user.role_name in ('Student', 'GroupLeader') %}
                <div class="form-check float-left" id="checkbox_attendance_report_form">
                    <a href="{{ url_for('attendance_report_current_course', subject_name=english_subject_name, display_mode='all') }}" class="report-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-check-fill" viewBox="0 0 16 16">
                            <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zm1.354 4.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708.708z">
                            </path>
                        </svg>
                        Отчёт
                    </a>
                </div>
            {% endif %}
        </div>
        <div class="col my-auto">
            <h1>Посещаемость</h1>
        </div>
        <div class="col my-auto">
            {% if current_user.role_name in ('Teacher') or (current_user.role_name in ('GroupLeader') and can_expose_group_leader) %}
                <input class="form-control" type="number" size="20" id="card_number" name="card_number" placeholder="Введите номер карты" required>
            {% endif %}
        </div>
    </div>
    <div class="row border-bottom border-top">
        <div class="col p-0">
            <select class="custom-select" style="border-radius: 0;" id="course">
                {% for i in range(1, 5) %}
                    {% if i != course %}
                        <option value="{{ i }}">{{ i }} курс</option>
                    {% else %}
                        <option value="{{ i }}" selected>{{ i }} курс</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col p-0">
            <select class="custom-select" style="border-radius: 0;" id="group">
                {% for group in groups %}
                    {% if group.num == selected_group.num and group.subnum == selected_group.subnum %}
                        <option value="{{ group.num_print }}" selected>{{ group.num_print }} группа</option>
                    {% else %}
                        <option value="{{ group.num_print }}">{{ group.num_print }} группа</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col p-0">
            <select class="custom-select" style="border-radius: 0;" id="lesson_type">
                {% for lesson_type in lesson_types %}
                    {% if lesson_type == selected_lesson_type %}
                        <option value="{{ lesson_type }}" selected>{{ lesson_type }}</option>
                    {% else %}
                        <option value="{{ lesson_type }}">{{ lesson_type }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col p-0">
            <select class="custom-select" style="border-radius: 0;" id="lesson">
                {% for subject in subjects %}
                    {% if subject.name == selected_subject %}
                        <option value="{{ subject.name }}" selected>{{ subject.name }}</option>
                    {% else %}
                        <option value="{{ subject.name }}">{{ subject.name }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
    </div>
    <table class="table" id="table-attendance">
        <thead>
        <tr> <!-- 12 дат (2 недели) -->
            <th scope="col">ФИО студента/Дата проведения занятия</th>
            {% for week_date, teaching_pair_id in week_dates|zip(teaching_pair_ids) %}
                <th scope="col" class="align-middle" data-teaching_pair_id="{{ teaching_pair_id }}">{{ week_date }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for student in students %}
            <tr>
                <input type="hidden" name="card_number" value="{{ student.card_number }}">
                <td class="align-middle font-weight-bold">{{ student.full_name }}</td>
                {% for attend in student.attendance %}
                    <td class="align-middle h2">
                    {% if attend %}
                        {% if attend.lesson_attendance %}
                            +
                        {% else %}
                            -
                        {% endif %}
                    {% endif %}
                    </td>
                {% endfor %}
                {% for _ in range(student.attendance|length, week_dates|length) %}
                    <td class="align-middle h2"></td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<script type="text/javascript">{% include 'js/attendance.js' %}</script>
</body>
</html>